# This file was generated using Kotlin DSL (.github/workflows/package.main.kts).
# If you want to modify the workflow, please change the Kotlin file and regenerate this YAML file.
# Generated with https://github.com/typesafegithub/github-workflows-kt

name: 'Package release'
on:
  release:
    types:
    - 'created'
jobs:
  package-windows-amd64:
    runs-on: 'windows-latest'
    permissions:
      contents: 'read'
      packages: 'write'
    steps:
    - id: 'step-0'
      uses: 'actions/checkout@v4'
    - id: 'step-1'
      uses: 'actions/setup-java@v4'
      with:
        java-version: '21'
        distribution: 'zulu'
    - id: 'step-2'
      uses: 'gradle/actions/setup-gradle@v4'
    - id: 'step-3'
      run: |-
        ./gradlew :generateComposeResClass
        ./gradlew :generateResourceAccessorsForComposeMain
        ./gradlew :generateExpectResourceCollectorsForCommonMain
        ./gradlew :generateActualResourceCollectorsForComposeJvmMain
        ./gradlew :assembleComposeJvmMainResources
        sed -i 's/Windows/Windows/g' source@compose/main/kotlin/core/PreConfiguration.kt
        sed -i 's/Amd64/Amd64/g' source@compose/main/kotlin/core/PreConfiguration.kt
    - id: 'step-4'
      name: 'package windows-uberjar-amd64'
      run: './gradlew :packageReleaseUberJarForCurrentOS'
    - id: 'step-5'
      uses: 'actions/upload-artifact@v4'
      with:
        name: 'MCL-windows-uberjar-amd64'
        path: 'build/compose/jars/*'
    - id: 'step-6'
      name: 'package windows-portable-amd64'
      run: './gradlew :packageReleaseAppImage'
    - id: 'step-7'
      uses: 'actions/upload-artifact@v4'
      with:
        name: 'MCL-windows-portable-amd64'
        path: 'build/compose/binaries/main-release/app/*'
    - id: 'step-8'
      name: 'package windows-installer-msi-amd64'
      run: './gradlew :packageReleaseMsi'
    - id: 'step-9'
      uses: 'actions/upload-artifact@v4'
      with:
        name: 'MCL-windows-installer-msi-amd64'
        path: 'build/compose/binaries/main-release/msi/*'
    - id: 'step-10'
      name: 'package windows-installer-exe-amd64'
      run: './gradlew :packageReleaseExe'
    - id: 'step-11'
      uses: 'actions/upload-artifact@v4'
      with:
        name: 'MCL-windows-installer-exe-amd64'
        path: 'build/compose/binaries/main-release/exe/*'
  package-windows-aarch64:
    runs-on: 'windows-11-arm'
    permissions:
      contents: 'read'
      packages: 'write'
    steps:
    - id: 'step-0'
      uses: 'actions/checkout@v4'
    - id: 'step-1'
      uses: 'actions/setup-java@v4'
      with:
        java-version: '21'
        distribution: 'zulu'
    - id: 'step-2'
      uses: 'gradle/actions/setup-gradle@v4'
    - id: 'step-3'
      run: |-
        ./gradlew :generateComposeResClass
        ./gradlew :generateResourceAccessorsForComposeMain
        ./gradlew :generateExpectResourceCollectorsForCommonMain
        ./gradlew :generateActualResourceCollectorsForComposeJvmMain
        ./gradlew :assembleComposeJvmMainResources
        sed -i 's/Windows/Windows/g' source@compose/main/kotlin/core/PreConfiguration.kt
        sed -i 's/Amd64/Aarch64/g' source@compose/main/kotlin/core/PreConfiguration.kt
    - id: 'step-4'
      name: 'package windows-uberjar-aarch64'
      run: './gradlew :packageReleaseUberJarForCurrentOS'
    - id: 'step-5'
      uses: 'actions/upload-artifact@v4'
      with:
        name: 'MCL-windows-uberjar-aarch64'
        path: 'build/compose/jars/*'
    - id: 'step-6'
      name: 'package windows-portable-aarch64'
      run: './gradlew :packageReleaseAppImage'
    - id: 'step-7'
      uses: 'actions/upload-artifact@v4'
      with:
        name: 'MCL-windows-portable-aarch64'
        path: 'build/compose/binaries/main-release/app/*'
    - id: 'step-8'
      name: 'package windows-installer-msi-aarch64'
      run: './gradlew :packageReleaseMsi'
    - id: 'step-9'
      uses: 'actions/upload-artifact@v4'
      with:
        name: 'MCL-windows-installer-msi-aarch64'
        path: 'build/compose/binaries/main-release/msi/*'
    - id: 'step-10'
      name: 'package windows-installer-exe-aarch64'
      run: './gradlew :packageReleaseExe'
    - id: 'step-11'
      uses: 'actions/upload-artifact@v4'
      with:
        name: 'MCL-windows-installer-exe-aarch64'
        path: 'build/compose/binaries/main-release/exe/*'
  package-linux-amd64:
    runs-on: 'ubuntu-latest'
    permissions:
      contents: 'read'
      packages: 'write'
    steps:
    - id: 'step-0'
      uses: 'actions/checkout@v4'
    - id: 'step-1'
      uses: 'actions/setup-java@v4'
      with:
        java-version: '21'
        distribution: 'zulu'
    - id: 'step-2'
      uses: 'gradle/actions/setup-gradle@v4'
    - id: 'step-3'
      run: |-
        ./gradlew :generateComposeResClass
        ./gradlew :generateResourceAccessorsForComposeMain
        ./gradlew :generateExpectResourceCollectorsForCommonMain
        ./gradlew :generateActualResourceCollectorsForComposeJvmMain
        ./gradlew :assembleComposeJvmMainResources
        sed -i 's/Windows/Linux/g' source@compose/main/kotlin/core/PreConfiguration.kt
        sed -i 's/Amd64/Amd64/g' source@compose/main/kotlin/core/PreConfiguration.kt
    - id: 'step-4'
      name: 'package linux-uberjar-amd64'
      run: './gradlew :packageReleaseUberJarForCurrentOS'
    - id: 'step-5'
      uses: 'actions/upload-artifact@v4'
      with:
        name: 'MCL-linux-uberjar-amd64'
        path: 'build/compose/jars/*'
    - id: 'step-6'
      name: 'package linux-portable-amd64'
      run: './gradlew :packageReleaseAppImage'
    - id: 'step-7'
      uses: 'actions/upload-artifact@v4'
      with:
        name: 'MCL-linux-portable-amd64'
        path: 'build/compose/binaries/main-release/app/*'
    - id: 'step-8'
      name: 'package linux-installer-deb-amd64'
      run: './gradlew :packageReleaseDeb'
    - id: 'step-9'
      uses: 'actions/upload-artifact@v4'
      with:
        name: 'MCL-linux-installer-deb-amd64'
        path: 'build/compose/binaries/main-release/deb/*'
    - id: 'step-10'
      name: 'package linux-installer-rpm-amd64'
      run: './gradlew :packageReleaseRpm'
    - id: 'step-11'
      uses: 'actions/upload-artifact@v4'
      with:
        name: 'MCL-linux-installer-rpm-amd64'
        path: 'build/compose/binaries/main-release/rpm/*'
  package-linux-aarch64:
    runs-on: 'ubuntu-22.04-arm'
    permissions:
      contents: 'read'
      packages: 'write'
    steps:
    - id: 'step-0'
      uses: 'actions/checkout@v4'
    - id: 'step-1'
      uses: 'actions/setup-java@v4'
      with:
        java-version: '21'
        distribution: 'zulu'
    - id: 'step-2'
      uses: 'gradle/actions/setup-gradle@v4'
    - id: 'step-3'
      run: |-
        ./gradlew :generateComposeResClass
        ./gradlew :generateResourceAccessorsForComposeMain
        ./gradlew :generateExpectResourceCollectorsForCommonMain
        ./gradlew :generateActualResourceCollectorsForComposeJvmMain
        ./gradlew :assembleComposeJvmMainResources
        sed -i 's/Windows/Linux/g' source@compose/main/kotlin/core/PreConfiguration.kt
        sed -i 's/Amd64/Aarch64/g' source@compose/main/kotlin/core/PreConfiguration.kt
    - id: 'step-4'
      name: 'package linux-uberjar-aarch64'
      run: './gradlew :packageReleaseUberJarForCurrentOS'
    - id: 'step-5'
      uses: 'actions/upload-artifact@v4'
      with:
        name: 'MCL-linux-uberjar-aarch64'
        path: 'build/compose/jars/*'
    - id: 'step-6'
      name: 'package linux-portable-aarch64'
      run: './gradlew :packageReleaseAppImage'
    - id: 'step-7'
      uses: 'actions/upload-artifact@v4'
      with:
        name: 'MCL-linux-portable-aarch64'
        path: 'build/compose/binaries/main-release/app/*'
    - id: 'step-8'
      name: 'package linux-installer-deb-aarch64'
      run: './gradlew :packageReleaseDeb'
    - id: 'step-9'
      uses: 'actions/upload-artifact@v4'
      with:
        name: 'MCL-linux-installer-deb-aarch64'
        path: 'build/compose/binaries/main-release/deb/*'
    - id: 'step-10'
      name: 'package linux-installer-rpm-aarch64'
      run: './gradlew :packageReleaseRpm'
    - id: 'step-11'
      uses: 'actions/upload-artifact@v4'
      with:
        name: 'MCL-linux-installer-rpm-aarch64'
        path: 'build/compose/binaries/main-release/rpm/*'
  package-macos-aarch64:
    runs-on: 'macos-latest'
    permissions:
      contents: 'read'
      packages: 'write'
    steps:
    - id: 'step-0'
      uses: 'actions/checkout@v4'
    - id: 'step-1'
      uses: 'actions/setup-java@v4'
      with:
        java-version: '21'
        distribution: 'zulu'
    - id: 'step-2'
      uses: 'gradle/actions/setup-gradle@v4'
    - id: 'step-3'
      run: |-
        ./gradlew :generateComposeResClass
        ./gradlew :generateResourceAccessorsForComposeMain
        ./gradlew :generateExpectResourceCollectorsForCommonMain
        ./gradlew :generateActualResourceCollectorsForComposeJvmMain
        ./gradlew :assembleComposeJvmMainResources
        sed -i '' 's/Windows/Macos/g' source@compose/main/kotlin/core/PreConfiguration.kt
        sed -i '' 's/Amd64/Aarch64/g' source@compose/main/kotlin/core/PreConfiguration.kt
    - id: 'step-4'
      name: 'package macos-uberjar-aarch64'
      run: './gradlew :packageReleaseUberJarForCurrentOS'
    - id: 'step-5'
      uses: 'actions/upload-artifact@v4'
      with:
        name: 'MCL-macos-uberjar-aarch64'
        path: 'build/compose/jars/*'
    - id: 'step-6'
      name: 'package macos-installer-dmg-aarch64'
      run: './gradlew :packageReleaseDmg'
    - id: 'step-7'
      uses: 'actions/upload-artifact@v4'
      with:
        name: 'MCL-macos-installer-dmg-aarch64'
        path: 'build/compose/binaries/main-release/dmg/*'
